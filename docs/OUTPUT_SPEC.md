# 출력 스펙 및 기준

## JSON 출력 구조

### 매 대화마다 반환되는 정보

```json
{
  "답변": "많이 힘들었겠구나. 어떤 상황이었는지 조금 더 말해줄래?",
  "정서적 고통 상태": "높음",
  "자살 신호": "낮음",
  "위험 점수": 45,
  "다음 조치": "주의환기",
  "대화 종료": false,
  "종합 결과": null
}
```

### 대화 종료 시 추가 정보

```json
{
  "답변": "...",
  "정서적 고통 상태": "중간",
  "자살 신호": "없음",
  "위험 점수": 30,
  "다음 조치": "일반대화",
  "대화 종료": true,
  "종합 결과": {
    "대화 요약": "주요 고민: 힘들어 → 친구가 괴롭혔어",
    "최종 위험 점수": 30,
    "상태 추이": "안정화 중",
    "다음 대화 시 가이드": "긍정적인 루틴을 유지하고, 필요할 때 언제든 다시 대화해요.",
    "최종 정서적 고통 수준": "중간",
    "최종 자살 신호": "없음",
    "대화 턴 수": 8,
    "주요 주제": ["학교폭력/또래관계"]
  }
}
```

## 상태 체크 기준

### 1. 정서적 고통 상태 (emotional_distress)

**판단 기준:**
- **낮음**: 키워드 0개 또는 일반적인 대화
- **중간**: 키워드 1개 또는 강조 표현 1개
- **높음**: 키워드 3개 이상 또는 키워드 2개 + 강조 표현

**키워드:** 힘들, 괴롭, 불안, 우울, 외롭, 짜증, 분노, 무시, 따돌, 괴롭힘, 헛소문
**강조 표현:** 너무, 정말, 진짜, 완전, 계속

### 2. 자살 신호 (suicide_signal)

**판단 기준:**
- **없음**: 자살 관련 표현 없음
- **낮음**: "죽고 싶다" 같은 간접적 표현
- **중간**: "사라지고 싶다", "포기하고 싶다", "의미없다"
- **높음**: "자살", "죽고 싶", "죽을래", "끝내고 싶", "목숨", "살고 싶지 않다"

### 3. 위험 점수 (risk_score)

**계산 방식:**
- 기본 점수: 10
- 정서적 고통 중간: +20
- 정서적 고통 높음: +35
- 자살 신호 낮음: +20
- 자살 신호 중간: +45
- 자살 신호 높음: +70
- 최대 100점

### 4. 다음 조치 (next_action)

**판단 기준:**
- **일반대화**: 위험 점수 < 35
- **주의환기**: 위험 점수 35-59
- **전담자연계**: 위험 점수 60-79
- **즉시대응**: 위험 점수 ≥ 80

## 대화 종료 조건

1. **즉시 종료 (위험 상황)**
   - 위험 점수 ≥ 80
   - 전문가 개입 필요

2. **사용자 요청 종료**
   - "그만", "종료", "끝낼래", "끝", "안녕", "다음에", "나중에" 등

3. **자연스러운 종료**
   - 대화 10턴 이상 + 정서적 고통 낮음 + 위험 점수 < 35
   - 안정화된 상태

4. **긍정적 마무리**
   - "괜찮아", "고마워", "도움됐어", "이제 괜찮아", "좋아졌어" 등
   - 대화 6턴 이상

## 프론트엔드 표시 방법

### 학생 화면 (일반 사용자)
- **표시:** AI 답변만 표시
- **숨김:** 정서적 고통 상태, 자살 신호, 위험 점수, 다음 조치
- **이유:** 학생이 불안해하거나 방어적으로 변할 수 있음

### 관리자 화면 (로그인 후)
- **표시:** 모든 정보 표시
  - 정서적 고통 상태
  - 자살 신호
  - 위험 점수
  - 다음 조치
  - 종합 결과 (대화 종료 시)

### 대화 종료 시
- **학생 화면:** 종합 결과의 "다음 대화 시 가이드"만 친근하게 표시
- **관리자 화면:** 전체 종합 결과 표시

## 예시 시나리오

### 시나리오 1: 일반적인 고민
```
입력: "요즘 공부가 너무 힘들어"
출력:
{
  "답변": "공부가 힘들구나. 어떤 부분이 가장 힘든 것 같아?",
  "정서적 고통 상태": "중간",
  "자살 신호": "없음",
  "위험 점수": 30,
  "다음 조치": "일반대화",
  "대화 종료": false
}
```

### 시나리오 2: 위험 신호 감지
```
입력: "친구가 나를 괴롭혔어. 정말 죽고 싶어"
출력:
{
  "답변": "그런 일을 겪었다니 정말 힘들었을 것 같아. 지금은 안전한 곳에 있어?",
  "정서적 고통 상태": "높음",
  "자살 신호": "높음",
  "위험 점수": 105 (100으로 제한),
  "다음 조치": "즉시대응",
  "대화 종료": true,
  "종합 결과": {
    "대화 요약": "...",
    "최종 위험 점수": 100,
    "상태 추이": "위험",
    "다음 대화 시 가이드": "즉시 전문가 상담이 필요합니다. 1388 청소년 상담전화 또는 응급실을 방문하세요.",
    ...
  }
}
```
